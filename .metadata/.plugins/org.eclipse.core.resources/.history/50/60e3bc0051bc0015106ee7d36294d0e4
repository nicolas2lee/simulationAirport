/**
 * 
 */
package enstabretagne.SimEntity.airport;
import java.util.HashMap;
import java.util.LinkedList;

import enstabretagne.SimEntity.airplane.Airplane;
import enstabretagne.SimEntity.airplane.AirplaneFeature;
import enstabretagne.base.time.LogicalDuration;
import enstabretagne.base.utility.IRecordable;
import enstabretagne.base.utility.Logger;
import enstabretagne.simulation.components.IEntity;
import enstabretagne.simulation.components.SimEntity;
import enstabretagne.simulation.components.SimFeatures;
import enstabretagne.simulation.components.SimInitParameters;
import enstabretagne.simulation.core.SimEngine;
import enstabretagne.simulation.core.SimEvent;
/**
 * @author nicolas2lee
 *
 */
public class Airport extends SimEntity implements IRecordable {

	/**
	 * 
	 */
	HashMap<String, Airplane> initialAirplanes;
	LinkedList<Airplane> FIFO;
	
	public LinkedList<Airplane> getFIFO() {
		return FIFO;
	}


	public void setFIFO(LinkedList<Airplane> fIFO) {
		FIFO = fIFO;
	}

	
	public Airport(SimEngine engine, String name, SimFeatures features) {

		super(engine, name, features);
		AirportFeatures af = (AirportFeatures) features;
		//open time and close time need to be added after
		initialAirplanes = new HashMap<>();
		/*
		System.out.println(features);
		System.out.println(af);
		System.out.println(af.getAirplaneFeatures());*/
		for (AirplaneFeature apf : af.getAirplaneFeatures() ){
			if (apf != null){
				Airplane air = (Airplane) createChild(engine, Airplane.class, apf.getAirplaneId().toString(), (SimFeatures)apf);
				initialAirplanes.put(air.getAirplaneId(), air);
			}
		}
		
	}


	@Override
	public String[] getTitles() {
		String[] titles = {"Size of FIFO of wiating airplanes"};
		return titles;
	}

	@Override
	public String[] getRecords() {
		String[] records={Integer.toString(getFIFO().size())};
		return records;
	}

	@Override
	public String getClassement() {
		return "Airport";
		return null;
	}

	@Override
	public void onParentSet() {
		// TODO Auto-generated method stub
		
	}

	@Override
	protected void InitializeSimEntity(SimInitParameters init) {
		// TODO Auto-generated method stub
		
	}

	@Override
	protected void AfterActivate(IEntity sender, boolean starting) {
		//Post(new ClosedAirport());
		Post (new ObservationSizeOfFIFO());
		for (SimEntity a : getChildren())
			a.activate();
	}

	@Override
	protected void BeforeDeactivating(IEntity sender, boolean starting) {
		// TODO Auto-generated method stub
		
	}
	
	class ObservationSizeOfFIFO extends SimEvent{
		@Override
		public void Process() {
			//if (isOpened)
			Logger.Data((IRecordable) this.Owner());
			Post(this, getCurrentLogicalDate().add(LogicalDuration.ofMinutes(
					((AirportFeatures) getFeatures()).getFrequenceObservationSizeOfFIFO()
					)));
			
		}
		
	}
	
}
